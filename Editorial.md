# 解説

## 貪欲法による解法（その1）

貪欲法による解法を紹介します。

基本的なアイデアとしては、「まだ訪問していない惑星のうち、できるだけ消費エネルギーの小さいものに移動し続ける」というものです。

まず、宇宙ステーションの座標を決めるのは難しいので、適当に決め打つことにします。
ここでは適当に以下の8点としました（本当に適当なので、改善の余地が大いにあります）。

- $(300, 300)$
- $(300, 500)$
- $(300, 700)$
- $(500, 300)$
- $(500, 700)$
- $(700, 300)$
- $(700, 500)$
- $(700, 700)$

宇宙ステーションの座標を決め打ったら、経路を決めていきます。今回は以下のようなアルゴリズムとしました。

1. 現在の惑星を惑星1にセットする。
2. 未訪問の惑星がなくなるまで以下を繰り返す。
   1. 未訪問の惑星を全探索し、移動に必要な消費エネルギーの最も小さい惑星を見付ける。
   2. その惑星に移動する。
3. 最後に惑星1に戻る。

これを提出すると、 7,467,011点が得られました。

[解答コード例（Python）](https://yukicoder.me/submissions/774530)

seed=0のビジュアライザは以下のようになります。

## 貪欲法による解法（その2）

ビジュアライザを見ると、改善できそうな点がいくつか見つかります。大きなものとしては以下の2点でしょうか。

- 宇宙ステーションを全く使用していない
- 後半の経路が非常に長くなっている

今回の問題は、「消費エネルギーがユークリッド距離の2乗に比例する」「宇宙ステーションを使った方が消費エネルギーが小さい」という特徴があるため、惑星から惑星に直接移動するよりも、いくつかの経由地を経た方が消費エネルギーが小さくなることが多いです。

そこで、「頂点 $i$ から頂点 $i'$ に移動するときに必要な最小エネルギー」を前処理で全て求めておいて、移動時に経路を復元するという処理を付け加えてみましょう。 **太字** にしたところが今回追加したポイントです。

1. **Warshall-Floyd法を用いて、全点間の移動に必要な最小エネルギーを求めておく。**
2. 現在の惑星を惑星1にセットする。
3. 未訪問の惑星がなくなるまで以下を繰り返す。
   1. 未訪問の惑星を全探索し、移動に必要な消費エネルギーの最も小さい惑星を見付ける。
   2. **Dijkstra法を用いて、その惑星までの移動経路を復元する。**
   3. その惑星に移動する。
4. 最後に惑星1に戻る。**ここでもDijkstra法を用いて移動経路を復元する。**

これを提出すると、先程からスコアが大幅に上昇し、12,512,594点が得られました。

[解答コード例（Python）](https://yukicoder.me/submissions/774528)

seed=0のビジュアライザは以下のようになります。

この解法にはまだまだ改善余地があると思われます（宇宙ステーションの座標を適当に決めている点など）。色々と改善案を試してみてはいかがでしょうか。

## Writer解

Writer解は以下のような解法でした。

1. Warshall-Floyd法を用いて、宇宙ステーションを使わない場合の各惑星間の最小消費エネルギーを求めておく。
2. 焼きなましを行う。各宇宙ステーションの座標と経由地の訪問順を解として持つ。近傍は以下の4種類。
    - 近傍1 (20%) : 宇宙ステーションをランダムに選び、訪問順のランダムな位置に挿入する。
    - 近傍2 (20%) : 訪問順のランダムな位置から宇宙ステーションを削除する。
    - 近傍3 (10%) : ある宇宙ステーションを訪問順から全て削除し、ランダムに座標をずらした上で、各辺で宇宙ステーションを使う/使わないを貪欲に決め直す。
    - 近傍4 (50%) : 普通の2-optを行う。
3. 2.を乱数のseedを変えて約0.2秒ずつ5回繰り返し、最も良い解を採用する。
4. Dijkstra法を用いて、経路を復元する。

これを提出すると、14,910,719点が得られました。

[Writer解（Rust）](https://yukicoder.me/submissions/774386)

seed=0のビジュアライザは以下のようになります。

## 乱数シード

テストケース生成に使われたseeds.txtは以下の通りです。

```text
11842101973114091671
14864607931359227094
4039102405665148568
3407633431745257464
2062784810171812255
15566338592838499314
7117706948550324168
4688195570341051954
5697255538556537955
11480184260670861161
1581551967740578647
12474275471516646620
9038979559940336442
14025326715374410985
16911340998361769140
13868744249686205694
4549511933457915440
3597117492497161269
12585290728883746979
3058424668133027374
9255156005924401478
4013830532608084692
5797432114463986962
13775393527661927167
9222063102877661793
12237478002830418725
5051813998803940741
9252769228262587227
8026617116988969488
5106718824707952031
```
